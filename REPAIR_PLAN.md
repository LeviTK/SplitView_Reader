# SplitView Reader 修复意见（更新版）

本文档用于指导当前版本的修复优先级、收益评估与重构边界。

## 结论

- 值得修复：是。当前问题以交互准确性和稳定性为主，修复成本低于重构成本。
- 重构建议：小步重构，不建议整体重写。

## 修复优先级

1. 标签点击目标漂移（P0）
   - 风险：可能误提取错误节点，直接影响核心功能正确性。
   - 建议：记录“最后一次真实悬停节点”，标签点击时强制使用该节点。

2. expandContent 危险点击（P0）
   - 风险：文本匹配点击到 `a[href]` 触发跳转，可能中断提取。
   - 建议：默认仅允许 `button`、`[role=\"button\"]`，禁止点击链接节点。

3. 复制/PDF 导出异常兜底（P1）
   - 风险：浏览器权限或 API 兼容问题导致静默失败。
   - 建议：统一 `try/catch` + 通知提示，PDF 在 `afterprint` 后清理 iframe。

4. 权限范围收敛（P1）
   - 风险：`<all_urls>` 不利于审核和用户信任。
   - 建议：保留 `activeTab + scripting` 主路径，移除不必要 host 权限。

5. 消息协议与文档对齐（P2）
   - 风险：字符串散落、文档失真导致维护成本增加。
   - 建议：抽取消息常量，更新 README 为当前真实流程。

## 重构边界

以下场景不需要整体重构：
- 仅修复提取准确性、点击安全性、导出稳定性。

以下场景建议进行小步重构：
- 增加大量站点规则。
- 加入后台代理请求、复杂消息类型。
- 出现频繁样式污染，需切换 Shadow DOM。

